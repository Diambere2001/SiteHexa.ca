{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Commander - {{ product.nom|default:product.title }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* (ton CSS existant) */
  </style>
</head>
<body>
<div class="container">
  <div class="order-container row align-items-center">
    <div class="col-md-5 product-image text-center mb-4 mb-md-0">
      <img src="{{ product.image.url }}" class="img-fluid" alt="{{ product.nom|default:product.title }}">
    </div>

    <div class="col-md-7">
      <h2 class="mb-3">{{ product.nom|default:product.title }}</h2>
      <p class="fs-4 text-success mb-4">{{ product.prix|default:product.price }} $</p>

      <form method="post" novalidate>
        {% csrf_token %}
        {% if form %}
          {% for field in form %}
            <div class="mb-3">
              <label class="form-label">{{ field.label }}</label>
              {{ field }}
              {% if field.errors %}<div class="text-danger small">{{ field.errors }}</div>{% endif %}
            </div>
          {% endfor %}
        {% else %}
          <!-- Form minimal si tu n'as pas de form class -->
          <div class="mb-3"><label class="form-label">Nom</label><input name="nom" class="form-control" required></div>
          <div class="mb-3"><label class="form-label">Prénom</label><input name="prenom" class="form-control"></div>
          <div class="mb-3"><label class="form-label">Adresse</label><textarea name="adresse" class="form-control"></textarea></div>
          <div class="mb-3"><label class="form-label">Téléphone</label><input name="telephone" class="form-control"></div>
          <div class="mb-3"><label class="form-label">Courriel</label><input name="courriel" class="form-control" value="{{ request.user.email }}"></div>
        {% endif %}

        <button type="submit" class="btn btn-order btn-lg w-100">Commander</button>
      </form>

      <!-- Si il y a une commande existante, afficher code-barres / QR et téléchargement PDF -->
      {% if order %}
        <hr class="my-4">
        <h5>Dernière commande : #{{ order.id }}</h5>
        <p>Passée le : {{ order.date_commande }}</p>

        {% if barcode_base64 %}
          <div class="mb-3">
            <strong>Code-barres :</strong><br>
            <img src="data:image/png;base64,{{ barcode_base64 }}" alt="code-barres" class="img-fluid" style="max-width:320px;">
          </div>
        {% endif %}

        {% if qrcode_base64 %}
          <div class="mb-3">
            <strong>QR Code :</strong><br>
            <img src="data:image/png;base64,{{ qrcode_base64 }}" alt="qr" class="img-fluid" style="max-width:120px;">
          </div>
        {% endif %}

        <a href="{% url 'download_order_pdf' order.id %}" class="btn btn-secondary">Télécharger le reçu (PDF)</a>
      {% endif %}

    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
